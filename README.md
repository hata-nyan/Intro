# python botter つまづきポイント
botter ３年生から送る　botter１年生のつまづきポイント

///

＊＊＊自己の反省を踏まえ、未来のbotterへ送るプレゼント＊＊＊

///

**雑感**　．．．ここでつまづいた

●どのプログラムを利用するか。

    →知っているプログラムでよいと思う。

（私はBasicやFortranしか習ったことがない、しかも忘れていたので、割と簡単そうなpythonを選択。）

●環境構築でつまづいた。

 windowsの場合、pythonが入っていないのでインストールする必要がある。

    →python＋spyderの場合は、さらのPCにspyderのみインストールすると、pythonは自動的にspyderのフォルダへインストールされる。

（Anacondaを入れてspyderを使ってたら、不要なアプリがたくさんあったり、使っているうちに、ぐじゃぐじゃになってしまった。）

●APIをたたくところ。private APIの認証のところ

    →取引所のAPIサンプルがあればうれしい。ccxtやpython用のSDKを利用。

（APIキーって何？、というところから始まった。今はClassを自作して運用しやすいようにしている）

●変数の型（int、float、str、list、dict、None、とか）の理解がなかったため、そこらじゅうでバグが発生

APIのpriceやamountを取ってきたあとで、そのまま計算しようとしたらなぜかエラーがでた。

    →取ってきた後に、四則演算をするためには、intやfloatなどの数値型に変換する必要がある。

●日付の処理について、時系列データは、python独自のdatetime型があるため、扱いが面倒。APIから取ってくるとstr（文字列型）になっていたりするので、datetime型へ変換する必要あり。

（処理によってはしなくてもよい場合もある）

また、よく使われる unixtime（intまたはfloat）との直接比較ができない

●（やや高度なところ）pandasのデータフレームから値をとってくる場合は、float（df.at[0,'price']）とか、型変換しておくこと！

（例えば、int64とかだと、発注時にjsonへ変換できないエラーが発生する。pandas以外にもnumpyから取ってきたときも注意が必要！？）

///

**Tips**　（ヒント）

●動けばＯＫ　（pythonicになるな！）

●ただし、自分で書いたプログラムは2週間後には忘れていることもあるので、なるべくわかりやすく書くこと。　

（ある意味pythonicになっているか！）

●バグなきところにバグがある。　

（取引所のローディングが激しいタイミングをテストするのは、難しいところも．．．）

●単体テストは十分に。さもないと、あとで後悔する。

（訓練されていないbotを実戦投入するのは、死に至る）

●資産配分やロットははじめは少なめに。

●パソコンには余計なソフトを入れない。可能であれば、開発専用のPCを用意。

（AIとか使わなければ、それなりのPCでOK）

●APIキーの管理は厳重に。

　禁止事項：平文でbotプログラムに記述したり、GitHubにアップロードしないこと。
 
 →あなたの財産がなくなる可能性があります。

///

**失敗事例**

●バグで、ほぼ全財産、xemを買いまくった。

●バグで、xymを売りまくった。（つい最近）

等々、数知れず．．．

///

///

**【参考】　**．．．私のbotter環境

**開発環境**

windows10 or11　最近win11へアップデート

python 3.7(初期のころ) ~ 3.11 (最新) ※最近は仮想環境を利用

spyder　※変数エクスプローラーがあるIDE（開発環境）なので、botのテスト時に変数がちゃんと入っているか確認しやすい。
　　　　　（ただしメインプログラムの変数のみ。pandasのデータフレームはラズパイ環境だと非対応らしい）

pip が入っている場合は、sudo pip install spyderでインストールは可能

pipができない場合は、PATHが通っていないと思われる。


**運用環境**

ハード：ラズパイ4B～5　複数台

ソフト：ラズパイ4B+　=>　RaspiOS bullseye　すべてラズパイ５へ更新ずみ
       ラズパイ5　=>　RaspiOS bookmorm　※仮想環境が必要．．．ここでもつまづいた。

（電気代が安いので、えさ代が少なくて済みます。燃える心配もないし。夏場の温度管理は重要。）

       python 3.7 ~ 3.11.2(最新)．．．インストールずみ 
       Thonney　（IDE、編集用）．．．インストールずみ
       spyder (IDE、確認程度)．．．自分でインストール sudo pip install spyder
       libraoffice(Excelのようなもの)

botの仕様(一部):

    import pandas as pd
    import retry
    import requests
    from datetime import datetime,timedelta,date  
    import os,sys,time

※candkestick(=k-line)を扱うには時系列データを扱うため、pandasは必須です。
※numpyは使っていません。
※requestsは、APIたたくのに使います。
※websocketは使っていますが、オプションです。
※from datetime import datetime,timedelta,date で直接 datetimeクラスのdatetime,timedelta,dataメソッドが読み出せるの知らなくて、ここもつまづきポイントでした。
※ファイル操作を扱うos、sys.exit()で強制的にプログラムを終了するコマンド、botに休息を与える time.sleep() は必須です。    

その他

●Real VNC　でリモートでwindows PCやスマホからアクセスしている。（仕事休憩中や旅行中とかbotterの動きは時々チェック可能。）

    →ローカルPC間は無料だが、最近有料化したので、お金を支払って契約。

●bot数は、20～30個くらい。機能は単機能ｘ銘柄ごとに分けているので、多くなってしまう。

    →各botは、1000~2000行くらい

（とても人には見せられない、くそコードです。もとい、老後の資産を稼いでくれる頼りになるbotです。）

※メインプラグラムに入れたくない処理は、別のファイルに入れていて、これくらい。ビジュアル重視のため、無駄な処理が多いかも。

※仮想環境が不要な　ラズパイ4B+　と　昔のOS の組み合わせが吉。

    →プログラムのあるディレクトリーに移動して、
    python3 bot_xxxx_.py 
    で実行可能

※最低限のセキュリティーはちゃんとやりましょう。（ファイアーウォール=ufwとか） 

※botter諸先輩方からすると、当たり前じゃん！って、ツッコミ、ごもっとも。

※GitHub　いまいち使い方がわかりません。見づらいかも。こんな私でも、botterやっています。



